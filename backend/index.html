<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <title>ISS Tracker</title>
</head>
<body>
    Hello!
    <form action="" method="get">
        <input id="input-long" type="text" placeholder="Longitude"> <br>
        <input id="input-lat" type="text" placeholder="Latitude"> <br>
    </form>
    <button id="get-button" onclick="getTime()">Get Overhead Times</button>
    <div id="pos">
        <button onclick="getLocation()">My location</button>
    </div>
    <div id="result"></div>
</body>

<script>
    var x = document.getElementById("pos");
    var result = document.getElementById("result");
    var long = document.getElementById("input-long");
    var lat = document.getElementById("input-lat");
    var getBtn = document.getElementById("get-button");
    const url = "http://api.open-notify.org/iss-pass.json"

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {
        long.value = position.coords.longitude;
        lat.value = position.coords.latitude;
    }

    function getTime(){
        var requestUrl = `https://cors-anywhere.herokuapp.com/${url}?lat=${lat.value}&lon=${long.value}`
        fetch(requestUrl)
        .then(response => response.json())
        .then(data => {
            console.log("here");
            var timeList = data.response;
            var innerHtml = "";
            timeList.forEach(element => {
                var timestamp = element.risetime
                date = new Date(timestamp * 1000),
                innerHtml += `Rise time: ${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}, ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()} <br/>`;
                innerHtml += `Duration: ${element.duration} seconds <br>`;
            });
            result.innerHTML = innerHtml;
        }).catch(e => console.error(e))
    }
</script>
</html>